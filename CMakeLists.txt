CHECK_FUNCTION_EXISTS(lseek64 HAVE_LSEEK64)
IF(HAVE_LSEEK64)
  ADD_DEFINITIONS("-DHAVE_LSEEK64")
ENDIF()

CHECK_FUNCTION_EXISTS(powl HAVE_POWL)
IF(NOT HAVE_POWL)
  ADD_DEFINITIONS("-Dpowl=pow")
ENDIF()

# FIXME port the logic from configure.in
ADD_DEFINITIONS("-DFDATASYNC_USE_FSYNC")

CHECK_INCLUDE_FILES(limits.h HAVE_LIMIT_H)

CHECK_LIBRARY_EXISTS(pthread pthread_mutex_timedlock "" HAVE_PHTREAD_MUTEX_TIMEDLOCK)

ADD_DEFINITIONS("-DQ4M_VERSION_HEX=0x0009")
ADD_DEFINITIONS("-DQ4M_USING_CMAKE")

SET(Q4M_SOURCES src/queue_cond.cc src/ha_queue.cc)
INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/storage/q4m/src)
MYSQL_ADD_PLUGIN(queue ${Q4M_SOURCES} STORAGE_ENGINE MODULE_ONLY MODULE_OUTPUT_NAME "libqueue_engine")
